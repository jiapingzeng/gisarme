$(function(){function e(e){var t=$("#activities");t.append('<li class="collection-item">'+a(e)+"</li>"),t.scrollTop(t[0].scrollHeight)}function a(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function t(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<t.length;n++)e=t[n].split("="),a.push(e[0]),a[e[0]]=e[1];return a}function n(){var e=$(".cell").width();$(".cell").height(e),$(".cell").css("font-size",e/1.5);var a=$(".number").width();$(".number").height(a),$(".number").css("font-size",a/1.5)}var i,s,o=io();o.on("connected",function(a){console.log("connected to server"),e("You have connected")}),o.on("user connected",function(a){e(a.player.username+" is connected")}),o.on("user disconnected",function(a){e(a.player.username+" has disconnected")}),o.on("message",function(a){e(a.player?a.player.username+": "+a.message:a.message)}),o.on("game created",function(e){console.log(e.game.id),$("#gameLink").val("http://gisar.me/sudokuduel?id="+e.game.id),$("#gameLink").focus().select(),$("#copyLink").removeClass("disabled"),$("#player1").text(e.player.username),$("#gameBanner").removeClass("hide"),console.log("starting game"),o.emit("start game",{id:e.game.id})}),o.on("game joined",function(e){$("#player1").text(e.player.username),$("#gameBanner").removeClass("hide")}),o.on("join failed",function(e){$("#createGame").removeClass("disabled"),$("#joinGame").removeClass("disabled"),Materialize.toast("game not found",5e3)}),o.on("player joined",function(e){$("#player2").text(e.player.username)}),o.on("game started",function(e){i=e.game.board,s=e.game.solution;for(var a=0;a<81;a++){$("#cell"+(a+1)).text(i[a])}});var l=!1;t().id&&($("#createGame").addClass("disabled"),$("#joinGame").addClass("disabled"),o.emit("join game",{id:t().id})),$("#input").keydown(function(a){if(13==a.which){var t=$("#input").val();a.preventDefault(),l?t.trim()&&o.emit("send message",{message:t}):(o.emit("set username",{username:t}),e("You have set your name to "+t),$("#input").attr("placeholder","enter message"),l=!0),$("#input").val("")}}),$("#createGame").on("click",function(){$("#createGame").addClass("disabled"),$("#joinGame").addClass("disabled"),o.emit("create game")}),$("#joinGame").on("click",function(){$("#createGame").addClass("disabled"),$("#joinGame").addClass("disabled"),gameId=$("#gameId").val(),o.emit("join game",{id:gameId})}),$("#copyLink").on("click",function(){$("#gameLink").select();try{var e=document.execCommand("copy"),a=e?"link copied":"copy failed";Materialize.toast(a,5e3)}catch(e){Materialize.toast("unknown error",5e3)}}),$("#chatButton").on("click",function(){$("#chat").toggleClass("hide")}),$(".cell, .number").on("click",function(){if(i&&s){var e=$(".selected").first().text(),a=$(this).text();if($(this).hasClass("incorrect"))return $(this).text(""),$(this).removeClass("incorrect"),void $(this).removeClass("selected");if(a)a!=e&&($(".cell").removeClass("selected"),$(".number").removeClass("selected"),$(this).addClass("selected"),$(".cell").each(function(){var e=$(this);e.text()==a&&e.addClass("selected")}));else if(e){var t=$(this).attr("id").substring(4);i[t-1]=e,$(this).text(e),s[t-1]==e?$(this).addClass("selected"):$(this).addClass("incorrect")}}}),n(),$(window).on("resize",n)});