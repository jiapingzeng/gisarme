$(function(){function e(e){var n=$("#activities");n.append('<li class="collection-item">'+a(e)+"</li>"),n.scrollTop(n[0].scrollHeight)}function a(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(){for(var e,a=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),t=0;t<n.length;t++)e=n[t].split("="),a.push(e[0]),a[e[0]]=e[1];return a}function t(e,a){if(e===a)return!0;if(null==e||null==a)return!1;if(e.length!=a.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==a[n])return!1;return!0}function i(){r.emit("game finished")}function s(){var e=$(".cell").width();$(".cell").height(e),$(".cell").css("font-size",e/1.5);var a=$(".number").width();$(".number").height(a),$(".number").css("font-size",a/1.5)}var o,l,r=io();r.on("connected",function(a){console.log("connected to server"),e("You have connected")}),r.on("user connected",function(a){e(a.player.username+" is connected")}),r.on("user disconnected",function(a){e(a.player.username+" has disconnected")}),r.on("message",function(a){e(a.player?a.player.username+": "+a.message:a.message)}),r.on("game created",function(e){console.log(e.game.id),$("#gameLink").val("http://gisar.me/sudokuduel?id="+e.game.id),$("#gameLink").focus().select(),$("#copyLink").removeClass("disabled"),$("#player1").text(e.player.username),$("#gameBanner").removeClass("hide"),console.log("starting game"),r.emit("start game",{id:e.game.id})}),r.on("game joined",function(e){$("#player1").text(e.player.username),$("#gameBanner").removeClass("hide")}),r.on("join failed",function(e){$("#createGame").removeClass("disabled"),$("#joinGame").removeClass("disabled"),Materialize.toast("game not found",5e3)}),r.on("player joined",function(e){$("#player2").text(e.player.username)}),r.on("game started",function(e){o=e.game.board,l=e.game.solution;for(var a=0;a<81;a++){$("#cell"+(a+1)).text(o[a])}});var c=!1;n().id&&($("#createGame").addClass("disabled"),$("#joinGame").addClass("disabled"),r.emit("join game",{id:n().id})),$("#input").keydown(function(a){if(13==a.which){var n=$("#input").val();a.preventDefault(),c?n.trim()&&r.emit("send message",{message:n}):(r.emit("set username",{username:n}),e("You have set your name to "+n),$("#input").attr("placeholder","enter message"),c=!0),$("#input").val("")}}),$("#createGame").on("click",function(){$("#createGame").addClass("disabled"),$("#joinGame").addClass("disabled"),r.emit("create game")}),$("#joinGame").on("click",function(){$("#createGame").addClass("disabled"),$("#joinGame").addClass("disabled"),gameId=$("#gameId").val(),r.emit("join game",{id:gameId})}),$("#copyLink").on("click",function(){$("#gameLink").select();try{var e=document.execCommand("copy"),a=e?"link copied":"copy failed";Materialize.toast(a,5e3)}catch(e){Materialize.toast("unknown error",5e3)}}),$("#chatButton").on("click",function(){$("#chat").toggleClass("hide")}),$(".cell, .number").on("click",function(){if(o&&l){var e=$(".selected").first().text(),a=$(this).text();if($(this).hasClass("incorrect"))return $(this).text(""),$(this).removeClass("incorrect"),void $(this).removeClass("selected");if(a)a!=e&&($(".cell").removeClass("selected"),$(".number").removeClass("selected"),$(this).addClass("selected"),$(".cell").each(function(){var e=$(this);e.text()==a&&e.addClass("selected")}));else if(e){var n=$(this).attr("id").substring(4);o[n-1]=parseInt(e),$(this).text(e),l[n-1]==e?$(this).addClass("selected"):$(this).addClass("incorrect"),t(o,l)&&(i(),window.alert("You won!"))}}}),s(),$(window).on("resize",s)});